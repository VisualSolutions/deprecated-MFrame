"use strict";function feedFilter(){var scope=this;return scope.wordFilter=function(feed,list){return feed.filter(function(item){return!list.some(function(word){return item.title.contains(word)||item.item.contains(word)})})},scope.categoryFilter=function(feed,categories){return feed.filter(function(item){return categories.some(function(category){return item.category===category})})},scope}function feedStore(localStorageService){var scope=this;return scope.saveFeed=function(feed,key){localStorageService.isSupported&&localStorageService.set(key,feed)},scope.getFeed=function(key){localStorageService.isSupported&&localStorageService.get(key)},scope.removeFeed=function(key){localStorageService.isSupported&&localStorageService.remove(key)},scope.bindToScope=function(localScope,key){localStorageService.isSupported&&localStorageService.bind(localScope,key)},this}angular.module("mvFramework",["ngAnimate","LocalStorageModule"]),angular.module("mvFramework").directive("mvGrid",function(gridChecker){return{restrict:"A",scope:!0,replace:!0,template:'<div ng-style="blockStyles" ng-transclude></div>',transclude:!0,link:function(scope,element,attrs){scope.blockStyles={},scope.blockStyles.left=gridChecker.check(attrs.mvGrid,"left")*(100/24)+"%",scope.blockStyles.top=gridChecker.check(attrs.mvGrid,"top")*(100/24)+"%",scope.blockStyles.width=gridChecker.check(attrs.mvGrid,"width")*(100/24)+"%",scope.blockStyles.height=gridChecker.check(attrs.mvGrid,"height")*(100/24)+"%"}}}),angular.module("mvFramework").directive("mvImage",function(configFactory,$filter,gridChecker,$animate,$timeout,debugSelector,$rootScope,timerProvider,playbackManager){return{restrict:"E",replace:!0,scope:{path:"@"},templateUrl:"template/mv-image.html",link:function(scope,element,attr){function getConfig(){configFactory.getComponentConfig(scope.path).then(function(data){scope.config=data,setupConfig(),playbackManager.componentReady(timerName)})}function setupConfig(){scope.content="images/"+scope.config.params.value;angular.element(element.children()[0]);scope.containerStyles.left=gridChecker.check(scope.path,"left")*(100/24)+"%",scope.containerStyles.top=gridChecker.check(scope.path,"top")*(100/24)+"%",scope.containerStyles.width=gridChecker.check(scope.path,"width")*(100/24)+"%",scope.containerStyles.height=gridChecker.check(scope.path,"height")*(100/24)+"%";var ratioCheck=element[0].clientWidth>element[0].clientHeight;switch(scope.config.params.position){case"fit":scope.imageStyles.height=ratioCheck?"100%":"auto",scope.imageStyles.width=ratioCheck?"auto":"100%";break;case"fill":scope.imageStyles.height=ratioCheck?"auto":"100%",scope.imageStyles.width=ratioCheck?"100%":"auto";break;case"stretch":scope.imageStyles.height="100%",scope.imageStyles.width="100%";break;case"center":}var rotation=scope.config.styles.transform.value;scope.imageStyles.transform=rotation,scope.imageStyles.WebkitTransform=rotation,angular.forEach(scope.config.styles,function(style){"Rotation"!==style.name&&(scope.containerStyles[style.cssProperty]=style.value)})}scope.config=null,scope.containerStyles={},scope.imageStyles={},scope.content=null,scope.getConfig=getConfig,scope.setupConfig=setupConfig;var timerName="image"+scope.$id;scope.getConfig();var statusChecker=scope.$watch(function(){return playbackManager.ready},function(status){status===!0&&statusChecker()})}}}),angular.module("mvFramework").run(["$templateCache",function($templateCache){$templateCache.put("template/mv-image.html",'<div class="mv-image" ng-style="containerStyles">  <div class="image-helper"><img ng-style="imageStyles" ng-src="{{content}}" alt="{{path}}"/></div></div>')}]),function(){angular.module("mvFramework").directive("mvNews",function(yqlService,$interval,$animate,feedFilter){return{restrict:"E",templateUrl:function(tElem,tAttrs){var tpl="template/mv-news.html";return tAttrs.templateUrl&&(tpl=tAttrs.templateUrl),tpl},scope:{path:"="},replace:!0,link:function(scope,element,attrs){scope.feed={},scope.itemStyles={},scope.containerStyles={},scope.config=null,scope.params=null;"news"+scope.$id;console.log(scope.feed)}}}),angular.module("mvFramework").run(["$templateCache",function($templateCache){$templateCache.put("template/mv-news.html",'<div class="mv-news" ng-style="containerStyles">  <div class="feed-item swap-animation" ng-animate-swap="currentItem" ng-style="itemStyles">    <div class="feed-item-title" ng-bind="currentItem.title"></div>    <div class="feed-item-body" ng-bind="currentItem.item"></div>      </div></div>')}])}(),angular.module("mvFramework").directive("mvText",function($interval,configFactory,$filter,$timeout,fontFactor,gridChecker,$animate,$rootScope,debugSelector,timerProvider,playbackManager){return{restrict:"E",replace:!0,scope:{path:"@"},templateUrl:"template/mv-text.html",link:function(scope,element,attr){function getConfig(){configFactory.getComponentConfig(scope.path).then(function(data){scope.config=data,setupConfig(),playbackManager.componentReady(timerName)})}function resizer(){var optimumSize=Math.sqrt(element[0].clientWidth*element[0].clientHeight/scope.content.length),newSize=Math.max(Math.min(optimumSize*fontFactor.factor,scope.config.params.fontMax),scope.config.params.fontMin);scope.textStyles.fontSize=newSize+"px"}function setupConfig(){scope.content=scope.config.params.value,angular.forEach(scope.config.styles,function(style){"verticalAlign"!==style.cssProperty&&(scope.containerStyles[style.cssProperty]=style.value)}),scope.textStyles.verticalAlign=scope.config.styles.verticalAlign.value,$timeout(function(){scope.containerStyles.left=gridChecker.check(scope.path,"left")*(100/24)+"%",scope.containerStyles.top=gridChecker.check(scope.path,"top")*(100/24)+"%",scope.containerStyles.width=gridChecker.check(scope.path,"width")*(100/24)+"%",scope.containerStyles.height=gridChecker.check(scope.path,"height")*(100/24)+"%",$timeout(function(){scope.containerStyles.lineHeight=element[0].clientHeight+"px",resizer()},30)},0)}scope.config=null,scope.containerStyles={},scope.textStyles={},scope.content=null,scope.getConfig=getConfig,scope.setupConfig=setupConfig;var timerName="text"+scope.$id;scope.getConfig();var statusChecker=scope.$watch(function(){return playbackManager.ready},function(status){status===!0&&statusChecker()})}}}),angular.module("mvFramework").run(["$templateCache",function($templateCache){$templateCache.put("template/mv-text.html",'<div class="mv-text" ng-style="containerStyles">  <span class="text-content" ng-bind="content" ng-style="textStyles"></span></div>')}]),!function(a,b){var c=b.isDefined,d=b.isUndefined,e=b.isNumber,f=b.isObject,g=b.isArray,h=b.extend,i=b.toJson,j=b.module("LocalStorageModule",[]);j.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){return this.prefix=a,this},this.setStorageType=function(a){return this.storageType=a,this},this.setStorageCookie=function(a,b){return this.cookie.expiry=a,this.cookie.path=b,this},this.setStorageCookieDomain=function(a){return this.cookie.domain=a,this},this.setNotify=function(a,b){return this.notify={setItem:a,removeItem:b},this},this.$get=["$rootScope","$window","$document","$parse",function(a,b,j,k){var l,m=this,n=m.prefix,o=m.cookie,p=m.notify,q=m.storageType;j?j[0]&&(j=j[0]):j=document,"."!==n.substr(-1)&&(n=n?n+".":"");var r=function(a){return n+a},s=function(){try{var c=q in b&&null!==b[q],d=r("__"+Math.round(1e7*Math.random()));return c&&(l=b[q],l.setItem(d,""),l.removeItem(d)),c}catch(e){return q="cookie",a.$broadcast("LocalStorageModule.notification.error",e.message),!1}}(),t=function(b,c){if(c=d(c)?null:i(c),!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),z(b,c);try{l&&l.setItem(r(b),c),p.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:m.storageType})}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.message),z(b,c)}return!0},u=function(b){if(!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),A(b);var c=l?l.getItem(r(b)):null;if(!c||"null"===c)return null;try{return JSON.parse(c)}catch(d){return c}},v=function(){var b,c;for(b=0;b<arguments.length;b++)if(c=arguments[b],s&&"cookie"!==m.storageType)try{l.removeItem(r(c)),p.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:c,storageType:m.storageType})}catch(d){a.$broadcast("LocalStorageModule.notification.error",d.message),B(c)}else s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:c,storageType:"cookie"}),B(c)},w=function(){if(!s)return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var b=n.length,c=[];for(var d in l)if(d.substr(0,b)===n)try{c.push(d.substr(b))}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.Description),[]}return c},x=function(b){var c=n?new RegExp("^"+n):new RegExp,d=b?new RegExp(b):new RegExp;if(!s||"cookie"===m.storageType)return s||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),C();var e=n.length;for(var f in l)if(c.test(f)&&d.test(f.substr(e)))try{v(f.substr(e))}catch(g){return a.$broadcast("LocalStorageModule.notification.error",g.message),C()}return!0},y=function(){try{return b.navigator.cookieEnabled||"cookie"in j&&(j.cookie.length>0||(j.cookie="test").indexOf.call(j.cookie,"test")>-1)}catch(c){return a.$broadcast("LocalStorageModule.notification.error",c.message),!1}}(),z=function(b,c,h){if(d(c))return!1;if((g(c)||f(c))&&(c=i(c)),!y)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var k="",l=new Date,m="";if(null===c?(l.setTime(l.getTime()+-864e5),k="; expires="+l.toGMTString(),c=""):e(h)&&0!==h?(l.setTime(l.getTime()+24*h*60*60*1e3),k="; expires="+l.toGMTString()):0!==o.expiry&&(l.setTime(l.getTime()+24*o.expiry*60*60*1e3),k="; expires="+l.toGMTString()),b){var n="; path="+o.path;o.domain&&(m="; domain="+o.domain),j.cookie=r(b)+"="+encodeURIComponent(c)+k+n+m}}catch(p){return a.$broadcast("LocalStorageModule.notification.error",p.message),!1}return!0},A=function(b){if(!y)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=j.cookie&&j.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(r(b)+"=")){var f=decodeURIComponent(e.substring(n.length+b.length+1,e.length));try{return JSON.parse(f)}catch(g){return f}}}return null},B=function(a){z(a,null)},C=function(){for(var a=null,b=n.length,c=j.cookie.split(";"),d=0;d<c.length;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);var e=a.substring(b,a.indexOf("="));B(e)}},D=function(){return q},E=function(a,b,d,e){e=e||b;var g=u(e);return null===g&&c(d)?g=d:f(g)&&f(d)&&(g=h(d,g)),k(b).assign(a,g),a.$watch(b,function(a){t(e,a)},f(a[b]))},F=function(){for(var a=0,c=b[q],d=0;d<c.length;d++)0===c.key(d).indexOf(n)&&a++;return a};return{isSupported:s,getStorageType:D,set:t,add:t,get:u,keys:w,remove:v,clearAll:x,bind:E,deriveKey:r,length:F,cookie:{isSupported:y,set:z,add:z,get:A,remove:B,clearAll:C}}}]})}(window,window.angular),function(){angular.module("mvFramework").service("animator",function($animateCss){this.setAnimations=function(){}})}(),angular.module("mvFramework").factory("configFactory",function(mvLoader,errorHandler,$q){function loadConfig(){var d=$q.defer();return null===scope.config||"undefined"==typeof scope.config?mvLoader.loadConfig().then(function(response){scope.config=response.data,d.resolve(response.data)}):d.resolve(scope.config),d.promise}function getComponentConfig(path){var d=$q.defer();return null===scope.config||"undefined"==typeof scope.config?loadConfig().then(function(data){scope.config=data,d.resolve(scope.config.components.filter(function(val){return val.path===path})[0])}):d.resolve(scope.config.components.filter(function(val){return val.path===path})[0]),d.promise}var scope=this;return scope.config=null,scope.getComponentConfig=getComponentConfig,scope.loadConfig=loadConfig,scope}),angular.module("mvFramework").factory("debugSelector",function(){function setDebug(option){scope.debug=option}var scope=this;return scope.debug=!1,scope.setDebug=setDebug,scope}),angular.module("mvFramework").factory("errorHandler",function(){function report(code){function error(code){function formatError(code,message){return"ERROR "+code+": "+message}switch(code){case 101:return formatError(101,"Failed to load JSON config file")}}console.log(error(code))}var scope=this;return scope.report=report,scope}),angular.module("mvFramework").service("feedFilter",feedFilter),angular.module("mvFramework").factory("feedStore",feedStore),angular.module("mvFramework").factory("fontFactor",function(){function setFactor(f){scope.factor=f}var scope=this;return scope.factor=.95,scope.setFactor=setFactor,scope}),angular.module("mvFramework").service("gridChecker",function(gridProvider,gridConfig,$window,$timeout){function check(pathName,prop){function getClasses(currentClass){return currentClass.indexOf("ls")>-1?["xsls","sls","mls","lls","ls","sq","pt","lpt","mpt","spt","xspt"]:currentClass.indexOf("sq")>-1?["tsq","sq","wsq","ls","pt","lls","lpt","mls","mpt","sls","spt","xsls","xspt"]:["xspt","spt","mpt","lpt","pt","sq","ls","lls","mls","sls","xsls"]}var componentConfig=null,currentClass=gridProvider.grid["class"],classes=getClasses(currentClass);if("string"==typeof pathName?componentConfig=gridConfig.getConfig(pathName):console.log("Error: pathName is not a string"),"undefined"!=typeof componentConfig[prop][currentClass])return componentConfig[prop][currentClass];for(var k=classes.indexOf(currentClass);k<classes.length;k++)if("undefined"!=typeof componentConfig[prop][classes[k]])return componentConfig[prop][classes[k]]}gridProvider.setupGrid($window.innerHeight,$window.innerWidth);var service=this;return service.check=check,service}),angular.module("mvFramework").factory("gridConfig",function(){function setConfig(configs){function checkConfig(config){scope.components.some(function(val,index,array){return val.pathName===config.pathName?(array.splice(1,index,val),!0):void 0})||scope.components.push(config)}configs instanceof Array?configs.map(function(val){checkConfig(val)}):checkConfig(configs)}function getConfig(pathName){return scope.components.filter(function(component){return component.pathName===pathName})[0]}var scope=this;return scope.components=[],scope.setConfig=setConfig,scope.getConfig=getConfig,scope}),angular.module("mvFramework").factory("gridProvider",function(){function setupGrid(windowHeight,windowWidth){scope.grid["class"]=setRatioClass(windowWidth/windowHeight)}function setRatioClass(ratio){switch(!0){case.1>ratio:return"xspt";case.2>ratio:return"spt";case.5>ratio:return"mpt";case.64>ratio:return"lpt";case.9>ratio:return"pt";case.96>ratio:return"tsq";case 1.1>ratio:return"sq";case 1.3>ratio:return"wsq";case 1.7>ratio:return"ls";case 2>ratio:return"lls";case 3>ratio:return"mls";case 5>ratio:return"sls";case ratio>5:return"xsls"}}var scope=this;return scope.grid={},scope.setupGrid=setupGrid,scope}),angular.module("mvFramework").service("mvLoader",function($http,errorHandler){function loadConfig(){return $http.get("mframe.json").success(function(data){return data}).error(function(){errorHandler.report(101)})}var service=this;return service.loadConfig=loadConfig,service}),angular.module("mvFramework").factory("playbackManager",function($timeout,configFactory){function setReady(){scope.ready=!0}var element,scope=this,components=[];return scope.duration=0,scope.ready=!1,scope.init=function(elem){configFactory.loadConfig().then(function(data){scope.config=data}),elem.style.visibility="hidden",element=elem},scope.componentReady=function(name){-1===components.indexOf(name)&&components.push(name),components.length===configFactory.config.components.length&&$timeout(function(){element.style.visibility="visible",setReady()},300)},scope}),angular.module("mvFramework").factory("rssLoader",function($http){var scope=this;return scope.loadRSS=function(){$http.get("http://silo.digichief.com/MMM_1-19-13/Weather/ZipCode/XML3/00659.XML").success(function(data){console.log(data)}).error(function(err){console.log("error",err)})},scope}),angular.module("mvFramework").factory("timerProvider",function($interval,$q){function startTimer(name){scope.timers.filter(function(timer){return timer.name===name})[0].start()}function stopTimer(name){scope.timers.filter(function(timer){return timer.name===name})[0].stop()}var scope=this;return scope.stopTimer=stopTimer,scope.startTimer=startTimer,scope}),angular.module("mvFramework").service("yqlService",function($q,$http){var scope=this;scope.getData=function(){var deferred=$q.defer(),query='select * from xml where url="http://silo.digichief.com/MMM_1-19-13/NewsII/XML/AllStories.xml"',url="http://query.yahooapis.com/v1/public/yql?q="+fixedEncodeURIComponent(query)+"&format=json";return console.log(url),$http.get(url).success(function(json){console.log(json);var entries=json.query.results.AllStories.news;deferred.resolve(entries)}).error(function(error){console.log(JSON.stringify(error))}),deferred.promise};var fixedEncodeURIComponent=function(str){return encodeURIComponent(str).replace(/[!'()]/g,escape).replace(/\*/g,"%2A").replace(/\"/g,"%22")};return scope});