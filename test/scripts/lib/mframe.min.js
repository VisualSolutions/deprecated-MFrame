"use strict";angular.module("mvFramework",["ngAnimate"]),angular.module("mvFramework").directive("mvGrid",function(gridChecker){return{restrict:"A",scope:!0,replace:!0,template:'<div ng-style="blockStyles" ng-transclude></div>',transclude:!0,link:function(scope,element,attrs){scope.blockStyles={},scope.blockStyles.left=gridChecker.check(attrs.mvGrid,"left")*(100/24)+"%",scope.blockStyles.top=gridChecker.check(attrs.mvGrid,"top")*(100/24)+"%",scope.blockStyles.width=gridChecker.check(attrs.mvGrid,"width")*(100/24)+"%",scope.blockStyles.height=gridChecker.check(attrs.mvGrid,"height")*(100/24)+"%"}}}),angular.module("mvFramework").directive("mvImage",function(configFactory,$filter,gridChecker,$animate,$timeout,debugSelector,$rootScope,debugTimer){return{restrict:"E",replace:!0,scope:{path:"@"},templateUrl:"template/mv-image.html",link:function(scope,element,attr){function getConfig(){configFactory.getComponentConfig(scope.path).then(function(data){scope.config=data,setupConfig()})}function setupConfig(){scope.content="images/"+scope.config.params.value;angular.element(element.children()[0]);scope.containerStyles.left=gridChecker.check(scope.path,"left")*(100/24)+"%",scope.containerStyles.top=gridChecker.check(scope.path,"top")*(100/24)+"%",scope.containerStyles.width=gridChecker.check(scope.path,"width")*(100/24)+"%",scope.containerStyles.height=gridChecker.check(scope.path,"height")*(100/24)+"%";var ratioCheck=element[0].clientWidth>element[0].clientHeight;switch(scope.config.params.position){case"fit":scope.imageStyles.height=ratioCheck?"100%":"auto",scope.imageStyles.width=ratioCheck?"auto":"100%";break;case"fill":scope.imageStyles.height=ratioCheck?"auto":"100%",scope.imageStyles.width=ratioCheck?"100%":"auto";break;case"stretch":scope.imageStyles.height="100%",scope.imageStyles.width="100%";break;case"center":}var rotation=scope.config.styles.transform.value;scope.imageStyles.transform=rotation,scope.imageStyles.WebkitTransform=rotation,angular.forEach(scope.config.styles,function(style){"Rotation"!==style.name&&(scope.containerStyles[style.cssProperty]=style.value)})}function initAnimations(event,duration){null===scope.config&&getConfig(),scope.config.animation&&(debugSelector.debug===!0&&debugTimer.setTimer(timerName+"Intro"),scope.config.animation.outro.duration+scope.config.animation.intro.duration>duration&&(scope.config.animation.outro.duration=1,scope.config.animation.intro.duration=1),$timeout(function(){element.removeClass(scope.config.animation.intro.animation+" "+scope.config.animation.intro.timingFunction+" duration-"+10*scope.config.animation.intro.duration),debugSelector.debug===!0&&debugTimer.stopTimer(timerName+"Intro"),element.removeClass(scope.config.animation.loop.animation+" infinite "+scope.config.animation.loop.timingFunction+" duration-"+10*scope.config.animation.loop.duration),debugSelector.debug===!0&&debugTimer.stopTimer(timerName+"Loop"),debugSelector.debug===!0&&debugTimer.setTimer(timerName+"Outro"),$animate.addClass(element,scope.config.animation.outro.animation+" "+scope.config.animation.outro.timingFunction+" duration-"+10*scope.config.animation.outro.duration).then(function(){debugSelector.debug===!0&&debugTimer.stopTimer(timerName+"Outro"),scope.config.animation.outro.animation.length>0&&element.addClass("no-display")})},1e3*(duration-scope.config.animation.outro.duration)),debugSelector.debug===!0&&debugTimer.setTimer(timerName+"Intro"),$animate.addClass(element,"animated "+scope.config.animation.intro.animation+" "+scope.config.animation.intro.timingFunction+" duration-"+10*scope.config.animation.intro.duration).then(function(){debugSelector.debug===!0&&debugTimer.stopTimer(timerName+"Intro"),element.removeClass(scope.config.animation.intro.animation+" "+scope.config.animation.intro.timingFunction+" duration-"+10*scope.config.animation.intro.duration),debugSelector.debug===!0&&debugTimer.setTimer(timerName+"Loop"),$animate.addClass(element,scope.config.animation.loop.animation+" infinite "+scope.config.animation.loop.timingFunction+" duration-"+10*scope.config.animation.loop.duration)}))}scope.config=null,scope.containerStyles={},scope.imageStyles={},scope.content=null,scope.getConfig=getConfig,scope.setupConfig=setupConfig;var timerName="image"+scope.$id;scope.getConfig(),scope.$on("animation-start",initAnimations)}}}),angular.module("mvFramework").run(["$templateCache",function($templateCache){$templateCache.put("template/mv-image.html",'<div class="mv-image" ng-style="containerStyles">  <div class="image-helper"><img ng-style="imageStyles" ng-src="{{content}}" alt="{{path}}"/></div></div>')}]),angular.module("mvFramework").directive("mvText",function($interval,configFactory,$filter,$timeout,fontFactor,gridChecker,$animate,$rootScope,debugSelector,debugTimer){return{restrict:"E",replace:!0,scope:{path:"@"},templateUrl:"template/mv-text.html",link:function(scope,element,attr){function getConfig(){configFactory.getComponentConfig(scope.path).then(function(data){scope.config=data,setupConfig()})}function resizer(){var optimumSize=Math.sqrt(element[0].clientWidth*element[0].clientHeight/scope.content.length),newSize=Math.max(Math.min(optimumSize*fontFactor.factor,scope.config.params.fontMax),scope.config.params.fontMin);scope.textStyles.fontSize=newSize+"px"}function setupConfig(){scope.content=scope.config.params.value,angular.forEach(scope.config.styles,function(style){"verticalAlign"!==style.cssProperty&&(scope.containerStyles[style.cssProperty]=style.value)}),scope.textStyles.verticalAlign=scope.config.styles.verticalAlign.value,$timeout(function(){scope.containerStyles.left=gridChecker.check(scope.path,"left")*(100/24)+"%",scope.containerStyles.top=gridChecker.check(scope.path,"top")*(100/24)+"%",scope.containerStyles.width=gridChecker.check(scope.path,"width")*(100/24)+"%",scope.containerStyles.height=gridChecker.check(scope.path,"height")*(100/24)+"%",$timeout(function(){scope.containerStyles.lineHeight=element[0].clientHeight+"px",resizer()},30)},0)}function initAnimations(event,duration){null===scope.config&&getConfig(),scope.config.animation&&(debugSelector.debug===!0&&debugTimer.setTimer(timerName+"Intro"),scope.config.animation.outro.duration+scope.config.animation.intro.duration>duration&&(scope.config.animation.outro.duration=1,scope.config.animation.intro.duration=1),$timeout(function(){element.removeClass(scope.config.animation.intro.animation+" "+scope.config.animation.intro.timingFunction+" duration-"+10*scope.config.animation.intro.duration),debugSelector.debug===!0&&debugTimer.stopTimer(timerName+"Intro"),element.removeClass(scope.config.animation.loop.animation+" infinite "+scope.config.animation.loop.timingFunction+" duration-"+10*scope.config.animation.loop.duration),debugSelector.debug===!0&&debugTimer.stopTimer(timerName+"Loop"),debugSelector.debug===!0&&debugTimer.setTimer(timerName+"Outro"),$animate.addClass(element,scope.config.animation.outro.animation+" "+scope.config.animation.outro.timingFunction+" duration-"+10*scope.config.animation.outro.duration).then(function(){debugSelector.debug===!0&&debugTimer.stopTimer(timerName+"Outro"),scope.config.animation.outro.animation.length>0&&element.addClass("no-display")})},1e3*(duration-scope.config.animation.outro.duration)),debugSelector.debug===!0&&debugTimer.setTimer(timerName+"Intro"),$animate.addClass(element,"animated "+scope.config.animation.intro.animation+" "+scope.config.animation.intro.timingFunction+" duration-"+10*scope.config.animation.intro.duration).then(function(){debugSelector.debug===!0&&debugTimer.stopTimer(timerName+"Intro"),element.removeClass(scope.config.animation.intro.animation+" "+scope.config.animation.intro.timingFunction+" duration-"+10*scope.config.animation.intro.duration),debugSelector.debug===!0&&debugTimer.setTimer(timerName+"Loop"),$animate.addClass(element,scope.config.animation.loop.animation+" infinite "+scope.config.animation.loop.timingFunction+" duration-"+10*scope.config.animation.loop.duration)}))}scope.config=null,scope.containerStyles={},scope.textStyles={},scope.content=null,scope.getConfig=getConfig,scope.setupConfig=setupConfig;var timerName="text"+scope.$id;scope.getConfig(),scope.$on("animation-start",initAnimations)}}}),angular.module("mvFramework").run(["$templateCache",function($templateCache){$templateCache.put("template/mv-text.html",'<div class="mv-text" ng-style="containerStyles">  <span class="text-content" ng-bind="content" ng-style="textStyles"></span></div>')}]),function(){angular.module("mvFramework").service("animator",function($animateCss){this.setAnimations=function(){}})}(),angular.module("mvFramework").factory("configFactory",function(mvLoader,errorHandler,$q){function loadConfig(){var d=$q.defer();return null===scope.config||"undefined"==typeof scope.config?mvLoader.loadConfig().then(function(response){d.resolve(response.data)}):d.resolve(scope.config),d.promise}function getComponentConfig(path){var d=$q.defer();return null===scope.config||"undefined"==typeof scope.config?loadConfig().then(function(data){scope.config=data,d.resolve(scope.config.components.filter(function(val){return val.path===path})[0])}):d.resolve(scope.config.components.filter(function(val){return val.path===path})[0]),d.promise}var scope=this;return scope.getComponentConfig=getComponentConfig,scope.loadConfig=loadConfig,scope}),angular.module("mvFramework").factory("debugSelector",function(){function setDebug(option){scope.debug=option}var scope=this;return scope.debug=!1,scope.setDebug=setDebug,scope}),function(){function decimalAdjust(type,value,exp){return"undefined"==typeof exp||0===+exp?Math[type](value):(value=+value,exp=+exp,isNaN(value)||"number"!=typeof exp||exp%1!==0?NaN:(value=value.toString().split("e"),value=Math[type](+(value[0]+"e"+(value[1]?+value[1]-exp:-exp))),value=value.toString().split("e"),+(value[0]+"e"+(value[1]?+value[1]+exp:exp))))}Math.round10||(Math.round10=function(value,exp){return decimalAdjust("round",value,exp)}),Math.floor10||(Math.floor10=function(value,exp){return decimalAdjust("floor",value,exp)}),Math.ceil10||(Math.ceil10=function(value,exp){return decimalAdjust("ceil",value,exp)})}(),angular.module("mvFramework").factory("debugTimer",function($interval){function setTimer(name){scope.timers.some(function(timer){return timer.name===name})||scope.timers.push(new Timer(name))}function stopTimer(name){scope.timers.filter(function(timer){return timer.name===name})[0].stop()}function Timer(name){var elapsed,startTime=(new Date).getTime(),scope=this;scope.name=name;var timeLoop=$interval(function(){var time=(new Date).getTime()-startTime;elapsed=Math.floor(time/100)/10,Math.round(elapsed)==elapsed&&(elapsed+=".00"),scope.value=elapsed},100);return scope.stop=function(){$interval.cancel(timeLoop)},scope}var scope=this;return scope.timers=[],scope.setTimer=setTimer,scope.stopTimer=stopTimer,scope}),angular.module("mvFramework").factory("errorHandler",function(){function report(code){function error(code){function formatError(code,message){return"ERROR "+code+": "+message}switch(code){case 101:return formatError(101,"Failed to load JSON config file")}}console.log(error(code))}var scope=this;return scope.report=report,scope}),angular.module("mvFramework").factory("fontFactor",function(){function setFactor(f){scope.factor=f}var scope=this;return scope.factor=.95,scope.setFactor=setFactor,scope}),angular.module("mvFramework").service("gridChecker",function(gridProvider,gridConfig,$window,$timeout){function check(pathName,prop){function getClasses(currentClass){return currentClass.indexOf("ls")>-1?["xsls","sls","mls","lls","ls","sq","pt","lpt","mpt","spt","xspt"]:currentClass.indexOf("sq")>-1?["tsq","sq","wsq","ls","pt","lls","lpt","mls","mpt","sls","spt","xsls","xspt"]:["xspt","spt","mpt","lpt","pt","sq","ls","lls","mls","sls","xsls"]}var componentConfig=null,currentClass=gridProvider.grid["class"],classes=getClasses(currentClass);if("string"==typeof pathName?componentConfig=gridConfig.getConfig(pathName):console.log("Error: pathName is not a string"),"undefined"!=typeof componentConfig[prop][currentClass])return componentConfig[prop][currentClass];for(var k=classes.indexOf(currentClass);k<classes.length;k++)if("undefined"!=typeof componentConfig[prop][classes[k]])return componentConfig[prop][classes[k]]}gridProvider.setupGrid($window.innerHeight,$window.innerWidth);var service=this;return service.check=check,service}),angular.module("mvFramework").factory("gridConfig",function(){function setConfig(configs){function checkConfig(config){scope.components.some(function(val,index,array){return val.pathName===config.pathName?(array.splice(1,index,val),!0):void 0})||scope.components.push(config)}configs instanceof Array?configs.map(function(val){checkConfig(val)}):checkConfig(configs)}function getConfig(pathName){return scope.components.filter(function(component){return component.pathName===pathName})[0]}var scope=this;return scope.components=[],scope.setConfig=setConfig,scope.getConfig=getConfig,scope}),angular.module("mvFramework").factory("gridProvider",function(){function setupGrid(windowHeight,windowWidth){scope.grid["class"]=setRatioClass(windowWidth/windowHeight)}function setRatioClass(ratio){switch(!0){case.1>ratio:return"xspt";case.2>ratio:return"spt";case.5>ratio:return"mpt";case.64>ratio:return"lpt";case.9>ratio:return"pt";case.96>ratio:return"tsq";case 1.1>ratio:return"sq";case 1.3>ratio:return"wsq";case 1.7>ratio:return"ls";case 2>ratio:return"lls";case 3>ratio:return"mls";case 5>ratio:return"sls";case ratio>5:return"xsls"}}var scope=this;return scope.grid={},scope.setupGrid=setupGrid,scope}),angular.module("mvFramework").service("mvLoader",function($http,errorHandler){function loadConfig(){return $http.get("mframe.json").success(function(data){return data}).error(function(){errorHandler.report(101)})}var service=this;return service.loadConfig=loadConfig,service}),angular.module("mvFramework").factory("playbackManager",function($timeout,configFactory,$rootScope,debugSelector){return this.init=function(elem,componentScope){function beginCycle(scope,duration){scope.$broadcast("animation-start",duration),$rootScope.$broadcast("debug-animation-start")}elem.style.visibility="hidden",configFactory.loadConfig().then(function(data){$timeout(function(){var configDuration=data.duration;1>configDuration||(elem.style.visibility="visible",beginCycle(componentScope,configDuration),$timeout(function(){},1e3*configDuration))},100)})},this});