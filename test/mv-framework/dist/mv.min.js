"use strict";angular.module("mvFramework",["ngFitText"]),angular.module("mvFramework").directive("mvImage",function(configFactory,$filter){return{restrict:"E",replace:!0,scope:{path:"@"},templateUrl:"template/mv-image.html",link:function(scope,element,attr){function getConfig(){configFactory.getComponentConfig(scope.path).then(function(data){console.log(data),scope.config=data,setupConfig()})}function setupConfig(){scope.content=scope.config.params.value;var imageElement=angular.element(element.children()[0]),ratioCheck=imageElement[0].clientWidth>imageElement[0].clientHeight;switch(scope.config.params.position){case"fit":scope.imageStyles.height=ratioCheck?"100%":"auto",scope.imageStyles.width=ratioCheck?"auto":"100%";break;case"fill":scope.imageStyles.height=ratioCheck?"auto":"100%",scope.imageStyles.width=ratioCheck?"100%":"auto";break;case"stretch":scope.imageStyles.height="100%",scope.imageStyles.width="100%";break;case"center":}angular.forEach(scope.config.styles,function(style){scope.containerStyles[style.cssProperty]=style.value})}scope.config=null,scope.containerStyles={},scope.imageStyles={},scope.content=null,scope.getConfig=getConfig,scope.setupConfig=setupConfig,scope.getConfig()}}}),angular.module("mvFramework").run(["$templateCache",function($templateCache){$templateCache.put("template/mv-image.html",'<div class="mv-image" ng-style="containerStyles">  <span class="image-helper"><img ng-style="imageStyles" ng-src="images/{{content}}" alt="{{path}}"/></span></div>')}]),angular.module("mvFramework").directive("mvText",function(configFactory,$filter,$timeout){return{restrict:"E",replace:!0,scope:{path:"@"},templateUrl:"template/mv-text.html",link:function(scope,element,attr){function getConfig(){configFactory.getComponentConfig(scope.path).then(function(data){console.log(data),scope.config=data,setupConfig()})}function setupConfig(){scope.content=scope.config.params.value,console.log("content",scope.content),$timeout(resizer(),1e3),angular.forEach(scope.config.styles,function(style){scope.containerStyles[style.cssProperty]=style.value})}scope.config=null,scope.containerStyles={},scope.textStyles={},scope.content=null,scope.getConfig=getConfig,scope.setupConfig=setupConfig,scope.getConfig();var resizer=function(){console.log(scope.content.length);var optimumSize=Math.sqrt(element[0].clientWidth*element[0].clientHeight/scope.content.length),newSize=Math.max(Math.min(optimumSize*scope.config.params.sizeFactor,scope.config.params.fontMax),scope.config.params.fontMin);scope.textStyles.fontSize=newSize+"px"}}}}),angular.module("mvFramework").run(["$templateCache",function($templateCache){$templateCache.put("template/mv-text.html",'<div class="mv-text" ng-style="containerStyles">  <span class="text-content" ng-bind="content" ng-style="textStyles"></span></div>')}]),function(){angular.module("mvFramework").service("animator",function($animateCss){this.setAnimations=function(){}})}(),angular.module("mvFramework").factory("configFactory",function(mvLoader,errorHandler,$q){function loadConfig(){var d=$q.defer();return mvLoader.loadConfig().then(function(response){d.resolve(response.data)}),d.promise}function getComponentConfig(path){var d=$q.defer();return console.log("componentconfig called"),null===scope.config?loadConfig().then(function(data){scope.config=data,d.resolve(scope.config.components.filter(function(val){return val.path===path})[0])}):d.resolve(scope.config.components.filter(function(val){return val.path===path})[0]),d.promise}var scope=this;return scope.config=null,scope.getComponentConfig=getComponentConfig,scope}),angular.module("mvFramework").factory("errorHandler",function(){function report(code){function error(code){function formatError(code,message){return"ERROR "+code+": "+message}switch(code){case 101:return formatError(101,"Failed to load JSON config file")}}console.log(error(code))}var scope=this;return scope.report=report,scope}),angular.module("mvFramework").service("gridChecker",function(gridProvider){function check(componentConfig,prop){function getClasses(){return grid["class"].indexOf("ls")>-1?["xsls","sls","mls","lls","ls","sq","pt","lpt","mpt","spt","xspt"]:grid["class"].indexOf("sq")>-1?["tsq","sq","wsq","ls","pt","lls","lpt","mls","mpt","sls","spt","xsls","xspt"]:["xspt","spt","mpt","lpt","pt","sq","ls","lls","mls","sls","xsls"]}var grid=gridProvider.grid,classes=getClasses();return"undefined"==typeof componentConfig[prop][grid["class"]]?componentConfig[prop][classes.slice(classes.indexOf(grid["class"]+1)).filter(function(className){return"undefined"!=typeof componentConfig[prop][className]})[0]]:void 0}gridProvider.setupGrid();var service=this;return service.check=check,service}),angular.module("mvFramework").factory("gridConfig",function(){function setConfig(configs){function checkConfig(config){scope.components.some(function(val,index,array){return val.pathName===config.pathName?(array.splice(1,index,val),!0):void 0})||scope.components.push(config)}"array"==typeof configs?configs.map(function(val){checkConfig(val)}):checkConfig(configs)}var scope=this;return scope.components=[],scope.setConfig=setConfig,scope}),angular.module("mvFramework").factory("gridProvider",function(){function setupGrid(windowHeight,windowWidth){scope.grid["class"]=setRatioClass(windowHeight/windowWidth),scope.grid.unitHeight=windowHeight/24,scope.grid.unitWidth=windowWidth/24}function setRatioClass(ratio){switch(!0){case.1>ratio:return"xspt";case.2>ratio:return"spt";case.5>ratio:return"mpt";case.64>ratio:return"lpt";case.9>ratio:return"pt";case.96>ratio:return"tsq";case 1.1>ratio:return"sq";case 1.3>ratio:return"wsq";case 1.7>ratio:return"ls";case 2>ratio:return"lls";case 3>ratio:return"mls";case 5>ratio:return"sls";case ratio>5:return"xsls"}}var scope=this;return scope.grid={},scope.setupGrid=setupGrid,scope}),angular.module("mvFramework").service("mvLoader",function($http,errorHandler){function loadConfig(){return console.log("load confog called"),$http.get("config.json").success(function(data){return console.log(data),data}).error(function(){errorHandler.report(101)})}var service=this;return service.loadConfig=loadConfig,service});